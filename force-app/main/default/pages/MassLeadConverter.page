<apex:page standardController="Lead" recordSetVar="leads" extensions="MassLeadConverterController" 
           sidebar="false" showHeader="true" tabStyle="Lead">
    
    <apex:slds />
    
    <style>
        /* Minimal CSS - let SLDS handle most styling */
        .inline-buttons { white-space: nowrap; text-align: center; }
        .inline-buttons .slds-button { margin-right: 8px; }
    </style>
    
    <apex:form id="massLeadForm">
        <apex:pageMessages />
        
        <!-- Page Header -->
        <apex:pageBlock title="Mass Lead Converter" id="mainBlock">
            
            <!-- Simple Action Buttons using standard pageBlockButtons -->
            <apex:pageBlockButtons location="top">
                <div class="inline-buttons">
                    <apex:commandButton value="Select All on Page" action="{!selectAll}" 
                                      reRender="mainBlock" styleClass="slds-button slds-button_neutral"/>
                    <apex:commandButton value="Deselect All" action="{!deselectAll}" 
                                      reRender="mainBlock" styleClass="slds-button slds-button_neutral"/>
                    <apex:commandButton value="Convert Selected Leads" action="{!convertSelectedLeads}" 
                                      reRender="mainBlock" styleClass="slds-button slds-button_brand"
                                      onclick="return confirm('Are you sure you want to convert the selected leads?');"/>
                </div>
            </apex:pageBlockButtons>
            
            <!-- Conversion Settings Section - Horizontal Layout with Better Alignment -->
            <apex:pageBlockSection title="Conversion Settings" columns="2" 
                                   collapsible="true" showHeader="true">
                
                <!-- Create Opportunity Setting -->
                <apex:pageBlockSectionItem>
                    <apex:outputPanel layout="block" style="display: flex; align-items: center; gap: 8px;">
                        <apex:outputLabel value="Create Opportunity:" for="createOpp" styleClass="slds-form-element__label" style="margin: 0; white-space: nowrap;"/>
                        <apex:inputCheckbox id="createOpp" value="{!createOpportunity}" style="margin: 0;"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                
                <!-- Send Email Setting -->
                <apex:pageBlockSectionItem>
                    <apex:outputPanel layout="block" style="display: flex; align-items: center; gap: 8px;">
                        <apex:outputLabel value="Send Email to Owner:" for="sendEmail" styleClass="slds-form-element__label" style="margin: 0; white-space: nowrap;"/>
                        <apex:inputCheckbox id="sendEmail" value="{!sendEmailToOwner}" style="margin: 0;"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                
                <!-- Descriptive Information spanning both columns -->
                <apex:pageBlockSectionItem>
                    <apex:outputPanel layout="block" styleClass="slds-m-top_small">
                        <div class="slds-text-body_small slds-text-color_default">
                            <strong>Note:</strong> Lead conversion will create Account and Contact records based on Lead data. Opportunities will be created if selected above.
                        </div>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem>
                    <apex:outputPanel layout="block">
                        <div class="slds-text-body_small slds-text-color_weak">
                            <em>Only unconverted leads are shown below. Already converted leads are automatically filtered out.</em>
                        </div>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                
            </apex:pageBlockSection>
            
            <!-- Selection Info -->
            <apex:outputPanel id="selectedInfo">
                <div style="margin: 10px 0; font-weight: bold;">
                    Selected: {!selectedCount} lead(s) | 
                    Page {!pageNumber} of {!totalPages} | 
                    Total Records: {!resultSize}
                </div>
            </apex:outputPanel>
            
            <!-- Lead Grid -->
            <apex:pageBlockSection title="Leads ({!resultSize} records)" columns="1" 
                                 collapsible="false" showHeader="true">
                <apex:pageBlockTable value="{!leadWrappers}" var="wrapper" id="leadTable" 
                                   styleClass="slds-table slds-table_cell-buffer slds-table_bordered">
                    
                    <!-- Selection Checkbox Column -->
                    <apex:column headerValue="Select" width="50px">
                        <apex:inputCheckbox value="{!wrapper.selected}">
                            <apex:actionSupport event="onchange" reRender="selectedInfo"/>
                        </apex:inputCheckbox>
                    </apex:column>
                    
                    <!-- Lead Name Column -->
                    <apex:column headerValue="Name" width="150px">
                        <apex:outputLink value="/{!wrapper.leadRecord.Id}" target="_blank">
                            {!wrapper.leadRecord.FirstName} {!wrapper.leadRecord.LastName}
                        </apex:outputLink>
                    </apex:column>
                    
                    <!-- Company Column -->
                    <apex:column headerValue="Company" value="{!wrapper.leadRecord.Company}" width="150px"/>
                    
                    <!-- Email Column -->
                    <apex:column headerValue="Email" value="{!wrapper.leadRecord.Email}" width="200px"/>
                    
                    <!-- Phone Column -->
                    <apex:column headerValue="Phone" value="{!wrapper.leadRecord.Phone}" width="120px"/>
                    
                    <!-- Status Column -->
                    <apex:column headerValue="Status" value="{!wrapper.leadRecord.Status}" width="100px"/>
                    
                    <!-- Lead Source Column -->
                    <apex:column headerValue="Lead Source" value="{!wrapper.leadRecord.LeadSource}" width="120px"/>
                    
                    <!-- Owner Column -->
                    <apex:column headerValue="Owner" value="{!wrapper.leadRecord.Owner.Name}" width="120px"/>
                    
                    <!-- Created Date Column -->
                    <apex:column headerValue="Created Date" width="100px">
                        <apex:outputText value="{0,date,MM/dd/yyyy}">
                            <apex:param value="{!wrapper.leadRecord.CreatedDate}"/>
                        </apex:outputText>
                    </apex:column>
                    
                    <!-- Individual Action Column using apex:param -->
                    <apex:column headerValue="Actions" width="80px">
                        <apex:commandLink value="Convert" 
                                        onclick="if(!confirm('Convert this lead?')) return false;"
                                        styleClass="slds-button slds-button_outline-brand slds-button_x-small">
                            <apex:param name="leadId" value="{!wrapper.leadRecord.Id}" assignTo="{!$CurrentPage.parameters.selectedLeadId}"/>
                            <apex:actionSupport event="onclick" action="{!convertSelectedLeads}" 
                                              reRender="mainBlock">
                                <!-- Using apex:param trick to select individual lead -->
                                <apex:param name="singleConvert" value="true"/>
                                <apex:param name="leadId" value="{!wrapper.leadRecord.Id}"/>
                            </apex:actionSupport>
                        </apex:commandLink>
                    </apex:column>
                    
                </apex:pageBlockTable>
            </apex:pageBlockSection>
            
            <!-- Simplified Pagination Controls -->
            <apex:pageBlockButtons location="bottom">
                <div class="inline-buttons">
                    <apex:commandButton value="<< First" action="{!first}" 
                                      disabled="{!NOT(hasPrevious)}" reRender="mainBlock"/>
                    <apex:commandButton value="< Previous" action="{!previous}" 
                                      disabled="{!NOT(hasPrevious)}" reRender="mainBlock"/>
                    <apex:outputText value="Page {!pageNumber} of {!totalPages}" 
                                   style="margin: 0 15px; line-height: 2rem;"/>
                    <apex:commandButton value="Next >" action="{!next}" 
                                      disabled="{!NOT(hasNext)}" reRender="mainBlock"/>
                    <apex:commandButton value="Last >>" action="{!last}" 
                                      disabled="{!NOT(hasNext)}" reRender="mainBlock"/>
                </div>
            </apex:pageBlockButtons>
            
        </apex:pageBlock>
    </apex:form>
    
</apex:page>